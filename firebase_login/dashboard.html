<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dashboard</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">

<style>
*{
  margin:0;
  padding:0;
  box-sizing:border-box;
  font-family:'Inter',sans-serif;
}
body{
  background:#f4f7f6;
}
.dashboard{
  display:flex;
  height:100vh;
  overflow:hidden;
}

/* Sidebar */
.sidebar{
  width:220px;
  background:#1f9d55;
  color:#fff;
  padding:20px;
  display:flex;
  flex-direction:column;
}
.sidebar h2{margin-bottom:30px;}
.sidebar a{
  display:flex;
  align-items:center;
  gap:8px;
  padding:10px;
  color:white;
  text-decoration:none;
  border-radius:8px;
  margin-bottom:10px;
}
.sidebar a.active,
.sidebar a:hover{
  background:rgba(255,255,255,0.2);
}
.sidebar .logout{margin-top:auto;}

/* Main */
.main{
  flex:1;
  padding:24px;
  overflow-y:auto;
}

/* Header */
.topbar{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:20px;
}
.profile-icon{
  width:36px;
  height:36px;
  border-radius:50%;
  background:#22c55e;
  display:flex;
  align-items:center;
  justify-content:center;
  color:white;
  font-weight:600;
}

/* Summary cards */
.cards{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
  gap:20px;
  margin-bottom:24px;
}
.card{
  background:linear-gradient(135deg,#ecfdf5,#d1fae5);
  padding:18px;
  border-radius:14px;
  box-shadow:0 8px 20px rgba(0,0,0,0.05);
}
.card h4{font-size:14px;color:#065f46;}
.card p{
  font-size:22px;
  font-weight:600;
  color:#15803d;
  margin-top:8px;
}

/* Common section */
.section{
  background:#fff;
  padding:20px;
  border-radius:14px;
  box-shadow:0 8px 20px rgba(0,0,0,0.05);
}

/* ================= GRID FIX ================= */
.dashboard-grid{
  display:grid;
  grid-template-columns:2fr 1fr;
  grid-template-rows:auto auto;
  gap:20px;
}

/* Weekly */
.weekly{
  grid-column:1;
  grid-row:1;
  height:320px;
}
.chart-container{flex:1;}
.weekly{
  height:420px;           /* BIG analytics card */
  display:flex;
  flex-direction:column;
}

.weekly .chart-container{
  flex:1;
  position:relative;
}

.weekly canvas{
  height:100% !important;
}



/* History */
.history{
  grid-column:1;
  grid-row:2;
  max-height:320px;
  overflow-y:auto;
}

/* AI Insights */
.ai-insight{
  grid-column:2;
  grid-row:1 / span 2;
  display:flex;
  flex-direction:column;
}
.ai-box{
  background:#ecfdf5;
  border-left:5px solid #22c55e;
  padding:16px;
  border-radius:10px;
  flex:1;
  overflow-y:auto;
}
.ai-box p{margin-bottom:10px;font-size:14px;}

/* Table */
table{
  width:100%;
  border-collapse:collapse;
}
th,td{
  padding:10px;
  border-bottom:1px solid #e5e7eb;
  font-size:14px;
}
th{color:#374151;}

@media(max-width:900px){
  .dashboard-grid{
    grid-template-columns:1fr;
  }
  .ai-insight{
    grid-column:1;
    grid-row:auto;
  }
}
</style>
</head>

<body>
<div class="dashboard">

<!-- SIDEBAR -->
<div class="sidebar">
  <h2>EcoPanel</h2>
  <a class="active"><span class="material-icons">dashboard</span>Dashboard</a>
  <a href="calculate.html"><span class="material-icons">calculate</span>Calculate</a>
  <a href="analytics.html"><span class="material-icons">analytics</span>Analytics</a>
  <a href="history.html"><span class="material-icons">history</span>History</a>
  <a href="ai-insights.html"><span class="material-icons">psychology</span>AI Insights</a>
  <a class="logout" href="index.html"><span class="material-icons">logout</span>Logout</a>
</div>

<!-- MAIN -->
<div class="main">
<h2 style="margin-bottom:8px;">Welcome back</h2>

<div class="topbar">
  <h3>Overview</h3>
  <div class="profile-icon">U</div>
</div>

<!-- CARDS -->
<div class="cards">
  <div class="card">
    <h4>Today's Consumption</h4>
    <p id="todayConsumption">- kWh</p>
  </div>
  <div class="card">
    <h4>Total Cost</h4>
    <p id="todayCost">â‚¹ -</p>
  </div>
</div>

<!-- GRID -->
<div class="dashboard-grid">

  <!-- Weekly Analytics -->
  <div class="section weekly">
    <h4>Weekly Energy Usage</h4>
    <div class="chart-container">
      <canvas id="weeklyChart"></canvas>
    </div>
  </div>

  <!-- AI Insights -->
  <div class="section ai-insight">
    <h4>AI Energy Insights</h4>
    <div class="ai-box" id="aiSummary">
      Loading AI insights...
    </div>
  </div>

  <!-- History -->
  <div class="section history">
  <h4>Previous Records</h4>
  <table>
    <thead>
      <tr>
        <th>Date</th>
        <th>Time</th>
        <th>Lab</th>        <!-- Added Lab column -->
        <th>Energy</th>
        <th>Cost</th>
      </tr>
    </thead>
    <tbody id="dashboardHistory"></tbody>
  </table>
</div>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script src="app.js"></script>
<script>
  firebase.auth().onAuthStateChanged(async user => {
  if (!user) return;

  const snap = await db.collection("AIInsights").doc(user.uid).get();
  if (!snap.exists) return;

  const ai = snap.data().summary;

  document.getElementById("aiSummary").innerHTML = `
    ðŸŸ¢ Safe: ${ai.safe.length}<br>
    ðŸ”´ Abnormal: ${ai.abnormal.length}<br>
    âš« Zero: ${ai.zero.length}<br>
    ðŸ”µ Efficient: ${ai.efficient.length}
  `;
});

</script>

</div>
</div>
</div>



</body>
</html>
